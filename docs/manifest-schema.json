{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/Chattadude/aicpm/blob/main/docs/manifest-schema.json",
  "title": "AICPM Manifest Schema",
  "description": "JSON Schema for AICPM (Authenticated AI Content Provenance Marking) manifest, version 0.1.",
  "type": "object",
  "additionalProperties": false,
  "required": ["aicpm_version", "created_at", "providers", "chunks"],
  "properties": {
    "aicpm_version": {
      "type": "string",
      "description": "AICPM manifest version identifier.",
      "pattern": "^(0\\.1)$"
    },
    "created_at": {
      "type": "string",
      "description": "ISO 8601 timestamp indicating when the manifest was created.",
      "format": "date-time"
    },
    "document_id": {
      "type": "string",
      "description": "Optional document identifier (opaque)."
    },
    "providers": {
      "type": "array",
      "description": "List of AI providers referenced by chunks in this manifest.",
      "minItems": 1,
      "items": { "$ref": "#/$defs/provider" }
    },
    "chunks": {
      "type": "array",
      "description": "List of signed AI-origin chunks embedded in the document.",
      "minItems": 1,
      "items": { "$ref": "#/$defs/chunk" }
    },
    "extensions": {
      "type": "object",
      "description": "Optional extension container for forward-compatible metadata.",
      "additionalProperties": true
    }
  },
  "$defs": {
    "b64url": {
      "type": "string",
      "description": "Base64url without padding.",
      "pattern": "^[A-Za-z0-9_-]+$"
    },
    "uuid": {
      "type": "string",
      "description": "UUID (RFC 4122).",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "provider": {
      "type": "object",
      "additionalProperties": false,
      "required": ["provider_id", "key_id", "public_key_b64u"],
      "properties": {
        "provider_id": {
          "type": "string",
          "description": "Stable provider identifier (DNS-like recommended).",
          "minLength": 3,
          "maxLength": 200
        },
        "key_id": {
          "type": "string",
          "description": "Identifier for the active verification key referenced by chunks.",
          "minLength": 1,
          "maxLength": 200
        },
        "alg": {
          "type": "string",
          "description": "Signature algorithm used for verification keys. Defaults to ed25519 if omitted.",
          "enum": ["ed25519"]
        },
        "public_key_b64u": {
          "$ref": "#/$defs/b64url",
          "description": "Provider public key encoded as base64url (raw 32-byte Ed25519 public key)."
        },
        "display_name": {
          "type": "string",
          "description": "Optional human-readable provider name."
        },
        "url": {
          "type": "string",
          "description": "Optional provider URL.",
          "format": "uri"
        },
        "extensions": {
          "type": "object",
          "description": "Provider-specific extensions.",
          "additionalProperties": true
        }
      }
    },
    "chunk": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "provider_id",
        "model_id",
        "session_id",
        "timestamp",
        "chunk_hash_b64u",
        "key_id",
        "sig_b64u",
        "text_len"
      ],
      "properties": {
        "id": {
          "description": "Chunk identifier. UUID recommended.",
          "anyOf": [
            { "$ref": "#/$defs/uuid" },
            { "type": "string", "minLength": 8, "maxLength": 200 }
          ]
        },
        "provider_id": {
          "type": "string",
          "description": "Provider identifier matching an entry in providers[].",
          "minLength": 3,
          "maxLength": 200
        },
        "model_id": {
          "type": "string",
          "description": "Provider-defined model identifier (opaque).",
          "minLength": 1,
          "maxLength": 200
        },
        "session_id": {
          "type": "string",
          "description": "Generation session identifier (opaque).",
          "minLength": 8,
          "maxLength": 200
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp when the chunk was generated/signed.",
          "format": "date-time"
        },
        "chunk_hash_b64u": {
          "$ref": "#/$defs/b64url",
          "description": "Base64url-encoded hash of the chunk text (SHA-256)."
        },
        "hash_alg": {
          "type": "string",
          "description": "Hash algorithm used. Defaults to sha256 if omitted.",
          "enum": ["sha256"]
        },
        "key_id": {
          "type": "string",
          "description": "Key identifier used to verify this chunk signature.",
          "minLength": 1,
          "maxLength": 200
        },
        "sig_b64u": {
          "$ref": "#/$defs/b64url",
          "description": "Base64url-encoded signature over the canonical signed payload."
        },
        "signed_payload": {
          "type": "object",
          "description": "Optional explicit signed payload object. If present, verifiers SHOULD treat it as the canonical payload. If absent, verifiers MUST construct the canonical payload from required fields.",
          "additionalProperties": true
        },
        "text_len": {
          "type": "integer",
          "description": "Length in characters of the chunk text as inserted at generation time.",
          "minimum": 0,
          "maximum": 10000000
        },
        "offset_hint": {
          "type": "object",
          "description": "Optional hint for locating the chunk in rendered documents. Non-normative and not used for verification.",
          "additionalProperties": false,
          "properties": {
            "path": { "type": "string" },
            "start": { "type": "integer", "minimum": 0 },
            "end": { "type": "integer", "minimum": 0 }
          }
        },
        "extensions": {
          "type": "object",
          "description": "Chunk-specific extensions.",
          "additionalProperties": true
        }
      }
    }
  }
}
